- [[https://github.com/kubevirt/kubevirt/blob/main/docs/vm-configuration.md][kubevirt/vm-configuration.md at main · kubevirt/kubevirt]]
- [[https://www.youtube.com/watch?v=Z9hBIoO4KOs&t=2490s][(91) KubeVirt deep dive - YouTube]]
- [[https://kubevirt.io/quickstart_minikube/][KubeVirt quickstart with Minikube | KubeVirt.io]]
- [[https://github.com/kubevirt/containerized-data-importer][kubevirt/containerized-data-importer: Data Import Service for kubernetes, designed with kubevirt in mind.]]
- [[https://github.com/k8snetworkplumbingwg/ovs-cni][k8snetworkplumbingwg/ovs-cni: Open vSwitch CNI plugin]]
- [[https://github.com/kubevirt/kubevirt/issues/6665][Is there a way to attach virtual machine storage to a LVM Group? · Issue #6665 · kubevirt/kubevirt]]
  - [[https://github.com/topolvm/topolvm][topolvm/topolvm: Capacity-aware CSI plugin for Kubernetes]]
- [[https://linbit.com/blog/using-drbd-block-devices-for-kubevirt/][Using DRBD block devices for kubevirt » LINBIT]]
- [[https://events19.linuxfoundation.org/wp-content/uploads/2018/07/Running-Legacy-VMs-with-Kubernetes.pdf][KubeVirt - Running-Legacy-VMs-with-Kubernetes.pdf]]
- [[https://kubevirt.io/2019/KubeVirt_storage_rook_ceph.html][Persistent storage of your Virtual Machines in KubeVirt with Rook | KubeVirt.io]]

* cdi

oleg@guixsd ~$ kubectl delete pvc/demo-vm-pv
persistentvolumeclaim "demo-vm-pv" deleted

oleg@guixsd ~$ kubectl get pvc -A
NAMESPACE   NAME                 STATUS        VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
default     demo-vm-pv-scratch   Bound         pvc-8a68838b-b6ff-46e3-a4c7-058a7b1107c3   2Gi        RWO            local-path     20m
default     demo-vm-pv           Bound         pvc-852f1d10-a8cc-4069-97c0-585f0563de04   2Gi        RWO            local-path     3d1h

* [[https://docs.openshift.com/container-platform/4.7/virt/virtual_machines/advanced_vm_management/virt-configuring-pxe-booting.html][Configuring PXE booting for virtual machines | OpenShift Virtualization | OpenShift Container Platform 4.7]]

#+begin_src yaml
  apiVersion: kubevirt.io/v1alpha3
  kind: VirtualMachineInstance
  metadata:
    creationTimestamp: null
    labels:
      special: vmi-pxe-boot
    name: vmi-pxe-boot
  spec:
    domain:
      devices:
        disks:
        - disk:
            bus: virtio
          name: containerdisk
          bootOrder: 2
        - disk:
            bus: virtio
          name: cloudinitdisk
        interfaces:
        - masquerade: {}
          name: default
        - bridge: {}
          name: pxe-net
          macAddress: de:00:00:00:00:de
          bootOrder: 1
      machine:
        type: ""
      resources:
        requests:
          memory: 1024M
    networks:
    - name: default
      pod: {}
    - multus:
        networkName: pxe-net-conf
      name: pxe-net
    terminationGracePeriodSeconds: 0
    volumes:
    - name: containerdisk
      containerDisk:
        image: kubevirt/fedora-cloud-container-disk-demo
    - cloudInitNoCloud:
        userData: |
          #!/bin/bash
          echo "fedora" | passwd fedora --stdin
      name: cloudinitdisk
  status: {}
#+end_src

Fix "reply from unexpected source"
: dig +short a gnu.org @10.43.0.10
modprobe br_netfilter
thanks [[https://stackoverflow.com/questions/48148838/kube-dns-error-reply-from-unexpected-source][kubernetes - kube-dns error: reply from unexpected source - Stack Overflow]]

* PVC

#+begin_example
  oleg@guixsd ~/.local/share/chezmoi/dotfiles/kubernetes/kubevirt/guix$ virtctl image-upload --pvc-name=guix-vm-pv --pvc-size=10Gi --image-path=$PWD/guix.qcow2 --uploadproxy-url=https://10.43.57.196 --insecure
  PVC default/guix-vm-pv not found
  PersistentVolumeClaim default/guix-vm-pv created
  Waiting for PVC guix-vm-pv upload pod to be ready...
  Pod now ready
  Uploading data to https://10.43.57.196

   426.38 MiB / 426.38 MiB [==========================================================================================================================================================] 100.00% 1s

  Uploading data completed successfully, waiting for processing to complete, you can hit ctrl-c without interrupting the progress
  Processing completed successfully
  Uploading /home/oleg/.local/share/chezmoi/dotfiles/kubernetes/kubevirt/guix/guix.qcow2 completed successfully
#+end_example
