- [[https://programmer.help/blogs/practice-vxlan-under-linux.html][Practice VxLAN under Linux]]
- [[https://russianblogs.com/article/15031512332/][–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∏ –ø—Ä–∞–∫—Ç–∏–∫–∞ VXLAN - –†—É—Å—Å–∫–∏–µ –ë–ª–æ–≥–∏]]
- [[https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_networking/assembly_using-a-vxlan-to-create-a-virtual-layer-2-domain-for-vms_configuring-and-managing-networking][Chapter¬†11.¬†Using a VXLAN to create a virtual layer-2 domain for VMs Red Hat Enterprise Linux 8 | Red Hat Customer Portal]]
- [[https://ilearnedhowto.wordpress.com/2017/02/16/how-to-create-overlay-networks-using-linux-bridges-and-vxlans/][How to create overlay networks using Linux Bridges and VXLANs ‚Äì I Learned How To‚Ä¶]]
- [[https://ilearnedhowto.wordpress.com/2016/09/16/how-to-create-a-overlay-network-using-open-vswitch-in-order-to-connect-lxc-containers/][How to create a overlay network using Open vSwitch in order to connect LXC containers. ‚Äì I Learned How To‚Ä¶]]
- [[https://docs.openvswitch.org/en/latest/faq/vxlan/][VXLANs ‚Äî Open vSwitch 3.0.90 documentation]]
- [[https://docs.openvswitch.org/en/latest/howto/userspace-tunneling/][Connecting VMs Using Tunnels (Userspace) ‚Äî Open vSwitch 3.0.90 documentation]]
- [[https://habr.com/ru/post/508832/][–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Open vSwitch —Å –†-–≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–µ–π / –•–∞–±—Ä]]
- [[https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_networking/assembly_using-a-vxlan-to-create-a-virtual-layer-2-domain-for-vms_configuring-and-managing-networking][Chapter¬†6.¬†Using a VXLAN to create a virtual layer-2 domain for VMs Red Hat Enterprise Linux 8 | Red Hat Customer Portal]]
- [[https://www.kernel.org/doc/Documentation/networking/vxlan.txt][kernel.org/doc/Documentation/networking/vxlan.txt]]
- [[https://vincent.bernat.ch/en/blog/2017-vxlan-linux][VXLAN & Linux]]
- [[https://joejulian.name/post/how-to-configure-linux-vxlans-with-multiple-unicast-endpoints/][How to configure linux vxlans with multiple unicast endpoints]]
- [[https://github.com/systemd/systemd/pull/12441][networkd: add support for bridge fdb destination address. by ssahani ¬∑ Pull Request #12441 ¬∑ systemd/systemd]]

* 

- [[https://wiki.astralinux.ru/pages/viewpage.action?pageId=158604065][–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ VLAN –∏ VXLAN –≤ Astra Linux - –°–ø—Ä–∞–≤–æ—á–Ω—ã–π —Ü–µ–Ω—Ç—Ä - –°–ø—Ä–∞–≤–æ—á–Ω—ã–π —Ü–µ–Ω—Ç—Ä Astra Linux]]

** 

#+begin_example
  –°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ VLAN —Å –ø–æ–º–æ—â—å—é —Å–ª—É–∂–±—ã networking

  –î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ VLAN —Å –ø–æ–º–æ—â—å—é —Å–ª—É–∂–±—ã networking

      –í–æ–π—Ç–∏ –≤ —Å–µ—Å—Å–∏—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–¥–ª—è Astra Linux Special Edition —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º –ú–ö–¶ ‚Äî –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å –≤—ã—Å–æ–∫–∏–º —É—Ä–æ–≤–Ω–µ–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏);

      –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–º–µ—é—â–∏—Ö—Å—è —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤:
      ip link show

      1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
          link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00

      2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000
          link/ether 52:54:00:64:d9:e8 brd ff:ff:ff:ff:ff:ff

      –î–∞–ª–µ–µ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å eth0;

      –í —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ç–µ–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫–∏:
      # The first VLAN interface
      auto eth0.500
      iface eth0.500 inet static
      address 172.20.20.10
      netmask 255.255.255.240
      gateway 172.20.20.1
      dns-nameservers 8.8.8.8 8.8.4.4

      –ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ç–µ–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ VLAN –¥–æ–ª–∂–Ω–æ –∏–º–µ—Ç—å —Ñ–æ—Ä–º—É <–∏–º—è_–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞>.<VLAN_ID>;

      –í–∫–ª—é—á–∏—Ç—å —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:
      sudo ifup eth0.500

      –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:
      sudo ifconfig eth0.500

  –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ VLAN
  # The second VLAN interface
  auto eth0.501
  iface eth0.501 inet static
  address 172.21.10.0
  netmask 255.255.255.0

  –ï—Å–ª–∏ —Ö–æ—Å—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –≥–∏–ø–µ—Ä–≤–∏–∑–æ—Ä–∞, —Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–µ—Ç–∏:

      –†–∞–∑—Ä–µ—à–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ç–∏ –ø–µ—Ä–µ—Å—ã–ª–∫—É –ø–∞–∫–µ—Ç–æ–≤:
      echo "net.ipv4.ip_forward=1" | sudo tee -a /etc/sysctl.conf
      echo "net.ipv4.conf.all.arp_filter=0" | sudo tee -a /etc/sysctl.conf
      echo "net.ipv4.conf.all.rp_filter=2" | sudo tee -a /etc/sysctl.conf

      –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
      sudo sysctl -p
#+end_example

** 

#+begin_example
  –í–∫–ª—é—á–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ VXLAN
  –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

      –°–æ–∑–¥–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ VXLAN:
      sudo ip link add vxlan0 type vxlan id 42 group 239.1.1.1 dev eth0 dstport 4789
      –£–∫–∞–∑–∞–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å –∏–º–µ–Ω–µ–º vxlan0. –≠—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —à–∏—Ä–æ–∫–æ–≤–µ—â–∞—Ç–µ–ª—å–Ω—É—é –≥—Ä—É–ø–ø—É 239.1.1.1 –∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ eth0 –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞, –Ω–µ –∏–º–µ—é—â–µ–≥–æ –ø—Ä–∞–≤–∏–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ –ø–µ—Ä–µ—Å—ã–ª–∫–∏ (—Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥–∞) –ø–∞–∫–µ—Ç–æ–≤. –¶–µ–ª–µ–≤–æ–π –ø–æ—Ä—Ç 4789 –≤—ã–±—Ä–∞–Ω –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º IANA;

      –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ VXLAN:
      sudo ip link delete vxlan0

      –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ VXLAN:
      sudo ip -d link show vxlan0

  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–∞–º–∏ –ø–µ—Ä–µ—Å—ã–ª–∫–∏ VXLAN –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã bridge:

      –°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ –≤ —Ç–∞–±–ª–∏—Ü–µ –ø–µ—Ä–µ—Å—ã–ª–∫–∏:
      sudo bridge fdb add to 00:17:42:8a:b4:05 dst 192.19.0.2 dev vxlan0

      –£–¥–∞–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ –ø–µ—Ä–µ—Å—ã–ª–∫–∏:
      sudo bridge fdb delete 00:17:42:8a:b4:05 dev vxlan0

      –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–∞–≤–∏–ª–∞—Ö –ø–µ—Ä–µ—Å—ã–ª–∫–∏:
      sudo bridge fdb show dev vxlan0

  –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ VXLAN –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π ifconfig:
  sudo ifconfig vxlan0

  –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π:
  sudo route -n

  –ü—Ä–æ—Å—Ç–µ–π—à—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, –≤—ã–ø–æ–ª–Ω–∏–≤ –∫–æ–º–∞–Ω–¥—É ping —Å –∞–¥—Ä–µ—Å–æ–º VXLAN –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:
  ping 10.0.0.107
#+end_example

** p2p

#+begin_example
  –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–µ–Ω–¥–∞:

      –°–µ—Ä–≤–µ—Ä 1:
          IP-–∞–¥—Ä–µ—Å: 172.31.0.106;
          VXLAN-–∞–¥—Ä–µ—Å: 10.0.0.106;
      –°–µ—Ä–≤–µ—Ä 2:
          IP-–∞–¥—Ä–µ—Å: 172.31.0.107;
          VXLAN-–∞–¥—Ä–µ—Å: 10.0.0.107;

  –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–µ–Ω–¥–∞:

      –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –°–µ—Ä–≤–µ—Ä–∞ 1:

          –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å VXLAN:
          sudo ip link add vxlan0 type vxlan id 1 remote 172.31.0.107 dstport 4789 dev eth0

          –í–∫–ª—é—á–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
          sudo ip link set vxlan0 up

          –ù–∞–∑–Ω–∞—á–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –∞–¥—Ä–µ—Å:
          sudo ip addr add 10.0.0.106/24 dev vxlan0

      –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –°–µ—Ä–≤–µ—Ä–∞ 2 –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –æ—Ç–ª–∏—á–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å–∞:
      sudo ip link add vxlan0 type vxlan id 1 remote 172.31.0.106 dstport 4789 dev eth0
      sudo ip link set vxlan0 up
      sudo ip addr add 10.0.0.107/24 dev vxlan0
#+end_example

** docker

#+begin_example
  VXLAN –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ Docker

  –î–∞–ª–µ–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–≤–µ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—ã:

      –•–æ—Å—Ç-–º–∞—à–∏–Ω–∞ 1:
          IP-–∞–¥—Ä–µ—Å: 172.31.0.106;
      –•–æ—Å—Ç-–º–∞—à–∏–Ω–∞ 2:
          IP-–∞–¥—Ä–µ—Å: 172.31.0.107;

  –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–∞ –∫–∞–∂–¥–æ–π —Ö–æ—Å—Ç-–º–∞—à–∏–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –æ–¥–Ω–æ–º—É —Å–µ—Ç–µ–≤–æ–º—É –º–æ—Å—Ç—É –∏ –º–æ–≥—É—Ç –∫–æ–º–º—É–Ω–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º, –∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ö–æ—Å—Ç-–º–∞—à–∏–Ω–∞—Ö –Ω–µ –º–æ–≥—É—Ç –∫–æ–º–º—É–Ω–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º (–¥–ª—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ü–û, –∫–∞–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä k8s). –í –Ω–∞—Å—Ç–æ—è—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ö–æ—Å—Ç-–º–∞—à–∏–Ω–∞—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã docker –∏ VXLAN.

  –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ docker –∏ —Å–æ–∑–¥–∞–Ω–∏—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Å–º. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏–∑–æ–ª—è—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π docker –≤ –û–° Astra Linux Special Edition 1.7. –î–∞–ª–µ–µ –≤ –ø—Ä–∏–º–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—Ä–∞–∑ wiki/astralinux:se.

  –î–∞–ª–µ–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ brctl –∏–∑ –ø–∞–∫–µ—Ç–∞ bridge-utils. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç bridge-utils –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π:
  sudo apt install bridge-utils
  –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ docker –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å - –º–æ—Å—Ç docker0, –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è IP-–∞–¥—Ä–µ—Å 172.17.0.1/16. –≠—Ç–æ —Å–µ—Ç–µ–≤–æ–π –º–æ—Å—Ç, —Å–æ–µ–¥–∏–Ω—è—é—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:
  sudo ifconfig docker0
  docker0: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500
         inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255
         ether 02:42:a9:5e:6f:00  txqueuelen 0  (Ethernet)
         RX packets 0  bytes 0 (0.0 B)
         RX errors 0  dropped 0  overruns 0  frame 0
         TX packets 0  bytes 0 (0.0 B)
         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
  IP-–∞–¥—Ä–µ—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ docker –Ω–∞–∑–Ω–∞—á–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏–Ω–∞—è —Å –∞–¥—Ä–µ—Å–∞ 172.17.0.2. –ß—Ç–æ–±—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å–∞ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–ª–µ–µ –≤ –ø—Ä–∏–º–µ—Ä–µ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä --ip. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö docker, –∏ —Ç–∞–∫—É—é —Å–µ—Ç—å –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–∞ –∫–∞–∂–¥–æ–π –∏–∑ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω:
  docker network create --subnet 172.18.0.0/16 mynetwork
  –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Ç–µ–π:
  docker network ls
  NETWORK ID     NAME        DRIVER    SCOPE
  265dff745581   bridge      bridge    local
  ddf7301657ff   host        host      local
  a28625161bb9   mynetwork   bridge    local
  b74b0b0796bb   none        null      local
  –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Ç–∏ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å br-... —Ç–∏–ø–∞ "–º–æ—Å—Ç":
  sudo ifconfig
  br-a28625161bb9: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500
         inet 172.18.0.1  netmask 255.255.0.0  broadcast 172.18.255.255
         ether 02:42:e9:f0:e9:a0  txqueuelen 0  (Ethernet)
         RX packets 0  bytes 0 (0.0 B)
         RX errors 0  dropped 0  overruns 0  frame 0
         TX packets 0  bytes 0 (0.0 B)
         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
  –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Å–µ—Ç—å –∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π IP-–∞–¥—Ä–µ—Å, –¥–ª—è –ø–µ—Ä–≤–æ–π —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—ã:
  docker run -itd --net mynetwork --ip 172.18.0.2 wiki/astralinux:se
  –î–ª—è –≤—Ç–æ—Ä–æ–π —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—ã:
  docker run -itd --net mynetwork --ip 172.18.0.3 wiki/astralinux:se
  –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Å–µ—Ç–∏ docker, –ø—Ä–∏–Ω—è—Ç–æ–π "–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é", —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ–º –∞–¥—Ä–µ—Å–∞:
  docker run -itd wiki/astralinux:se
  –¢–µ–ø–µ—Ä—å –Ω–∞ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω–∞—Ö –∏–º–µ—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:

      docker0 - –º–æ—Å—Ç, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ docker. –°–µ—Ç—å 172.17.0.0/16, IP-–∞–¥—Ä–µ—Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ 172.17.0.1;
      br-xxxx - –º–æ—Å—Ç —Å–µ—Ç–∏, —Å–æ–∑–¥–∞–Ω–Ω–æ–π –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–º–µ—Ä–∞. –°–µ—Ç—å 172.18.0.0/16, IP-–∞–¥—Ä–µ—Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ 172.18.0.1;
      vethxxxx - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤. –°–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ (–∑–∞–ø—É—Å–∫–µ) –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å eth0 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É veth;

  –ü—Ä–∏ —ç—Ç–æ–º –Ω–∞ –∫–∞–∂–¥–æ–π —Ö–æ—Å—Ç-–º–∞—à–∏–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

  –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ—Å—Ç–æ–≤ –∏ –∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ—Å–æ–≤ –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π brctl, –Ω–∞–ø—Ä–∏–º–µ—Ä:
  sudo brctl show          
  br-a28625161bb9         8000.0242e9f0e9a0       no              veth1675dd1
  docker0         8000.0242a95e6f00       no              vethe587b2d
  –î–∞–ª–µ–µ —Å–æ–∑–¥–∞–¥–∏–º —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã VXLAN –≤ –∫–∞–∂–¥–æ–π –∏–∑ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω, –∏ –ø–æ–¥–∫–ª—é—á–∏–º –∏—Ö –∫ –º–æ—Å—Ç—É docker. –°–µ—Ç–µ–≤—ã–µ –ø–∞–∫–µ—Ç—ã –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –±—É–¥—É—Ç –¥–æ—Å—Ç–∞–≤–ª—è—Ç—å—Å—è –≤ –º–æ—Å—Ç docker, –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ —Å–æ–æ–±—â–µ–Ω–∏—è VXLAN –∏ –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –≤—Ç–æ—Ä—É—é —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—É. –ù–∞ –≤—Ç–æ—Ä–æ–π —Ö–æ—Å—Ç-–º–∞—à–∏–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏—è VXLAN –ø–µ—Ä–µ—Å—ã–ª–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä docker —á–µ—Ä–µ–∑ –º–æ—Å—Ç –≤—Ç–æ—Ä–æ–π —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—ã.

      –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–≤–æ–π —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—ã:

          –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å VXLAN —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º (VNI) 2000 –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ–º vxlan_docker. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ—Ö–æ–∂–∏ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –ø—Ä–∏–º–µ—Ä–µ:
          sudo ip link add vxlan_docker type vxlan id 200 remote 172.31.0.107 dstport 4789 dev eth0

          –í–∫–ª—é—á–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å VLAN:
          sudo ip link set vxlan_docker up

          –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫ –º–æ—Å—Ç—É docker:
          sudo brctl addif br-3231f89d69f6 vxlan_docker

      –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ç–æ—Ä–æ–π —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—ã –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ:
      sudo ip link add vxlan_docker type vxlan id 200 remote 172.31.0.106 dstport 4789 dev eth0
      sudo ip link set vxlan_docker up
      sudo brctl addif br-f4b35af34313 vxlan_docker

  –î–∞–ª–µ–µ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã ping, –≤—ã–ø–æ–ª–Ω—è–µ–º–æ–π –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:
  ping 172.18.0.2
#+end_example

** Tunnel

*** First host tunnel side

#+begin_example
  ip link add vxlan0 type vxlan id 1 remote 88.XXX.XXX.XX dstport 4XXX dev eth0
  ip link set vxlan0 up
  ip addr add 10.X.X.X/24 dev vxlan0
#+end_example

*** Second host tunnel side

#+begin_example
  ip link add vxlan0 type vxlan id 1 remote 185.105.108.96 dstport 4XXX dev br0
  ip link set vxlan0 up
  ip addr add 10.X.X.XXX/24 dev vxlan0
  ip r add 141.XX.XXX.XX/32 via 10.X.X.X
#+end_example

*** NAT through first host

Make sure nftables packet is installed, then run:

#+begin_example
  nft add table nat
  nft 'add chain nat postrouting { type nat hook postrouting priority 100 ; }'
  nft add rule nat postrouting masquerade
  sysctl -w net.ipv4.ip_forward=1
#+end_example

* [[https://blog.thomas.maurice.fr/posts/some-vxlan-stuff-so-i-dont-forget/][Some VXLAN stuff so I don't forget how it works]]
üìÖ Aug 7, 2021
 ¬∑  ‚òï 2 min read

    üè∑Ô∏è
    #linux
    #networking
    #kernel
    #namespaces
    #vxlan

Just like my network namespace post, this post is going to be a basic cheat sheet for me so I don‚Äôt have to endlessly Google stuff for ages in case I need to use VXLANs again.
What is a VXLAN

Thta‚Äôs just a like a VLAN, essentially an overlay network that is not limited to 4000 IDs. It also has some nice features such as auto discovery of peers via broadcast on the same network.
Create a unicast vxlan interface

You can create a vxlan interface like so

$ ip link add name vx-0 type vxlan id 69 dev <IFACE> remote <REMOTE_IP> local <LOCAL_IP> dstport <PORT>
$ ip address add 10.69.0.1/24 dev vx-0
$ ip link set up dev vx-0

And mirror on the other host. Note that

    IFACE is the ‚Äúparent‚Äù interface of the VXLAN interface, it should be the interface you will use to
    communicate with the NUC.
    REMOTE_IP is the IP of the remote vxlan endpoint, not on the overlay network (so like your LAN IP)
    LOCAL_IP is the same but for your local machine
    PORT is the port you will send packets to

It is worth noting you can just omit local IP dstport PORT the kernel should figure it out.

You can also bridge the interface like so:

$ ip link add name vx-0 type vxlan id 69 dev <IFACE> remote <REMOTE_IP> local <LOCAL_IP> dstport <PORT>
$ ip link add br-vx-0 type bridge
$ ip address add 10.69.0.1/24 dev br-vx-0
$ ip link set master br-vx-0 dev vx-0
$ ip link set up dev br-vx-0
$ ip link set up dev vx-0
