* TODO Replace Zabbix web interface with alerta
  SCHEDULED: <2020-03-08 Sun>
* TODO Add docker alias
  SCHEDULED: <2020-03-19 Thu>
  #+BEGIN_SRC bash
    for service in $(docker service ls -q); do
      docker service inspect --format \
         '{{.Spec.Name}}: {{range .Endpoint.VirtualIPs}}{{.Addr}} {{end}}' \
         ${service}
    done
  #+END_SRC
* TODO Xorg keyboard layout
  SCHEDULED: <2020-03-18 Wed>
#+begin_example
  Section "InputClass"
    Identifier "Keyboard catchall"
    MatchIsKeyboard "on"
    Option "XkbModel" "pc104"
    Option "XkbLayout" "us,ru"
    Option "XkbOptions" "grp:menu_toggle,grp_led:scroll"
    Option "XkbVariant" ""
  EndSection
#+end_example
* TODO Build overlay recursively by providing NIX_PATH parameter
  SCHEDULED: <2020-03-09 Mon>
* TODO Parser Lebedeva /usr/lib/x86_64-linux-gnu/libmysqlclient.so.18
  SCHEDULED: <2020-01-20 Mon> DEADLINE: <2020-01-20 Mon>
* TODO MySQL upgrade
  SCHEDULED: <2020-01-31 Fri>
* TODO [[https://billing2.intr/vds/queue/item/257839][Freebsd Billing2 task]]
  SCHEDULED: <2020-01-20 Mon>
* TODO [[http://redmine.intr/issues/8833][Обновление MariaDB]]
  SCHEDULED: <2020-01-31 Fri>
* TODO NGINX Unit for NodeJS hosting
  SCHEDULED: <2020-01-24 Fri>
* TODO [[/home/oleg/src/gitlab.intr/Jenkinsfile]]
  SCHEDULED: <2020-01-26 Sun>
* TODO [[https://github.com/michaudg/godaddy-ddns/blob/master/godaddy.sh]]
  SCHEDULED: <2020-01-26 Sun>
* TODO Если размер базы больше чем 1.5 ГБ, то ее размер не учитывается. Пример b213062_test
  SCHEDULED: <2020-01-31 Fri>
* TODO [https://fosdem.org/2020/schedule/events/][FOSDEM 2020 - Events]
  SCHEDULED: <2020-02-09 Sun>
* TODO Fix configs in [[https://gitlab.intr/utils/ipmiview][ipmiview]] (need to symlink them)
  SCHEDULED: <2020-02-25 Tue>
* TODO Nixify Bitrix
  SCHEDULED: <2020-08-31 Mon>
* TODO Nixify PXE ~/majordomo/net/pxe/
  SCHEDULED: <2020-12-13 Sun>
* TODO Maybe replace ack with delete in Alerta web interface
  SCHEDULED: <2020-03-29 Sun>
* TODO debian9 $osVariant   = "debian8"; /ssh:kvm15.intr|sudo:root@kvm15.intr:/usr/local/repo/lib/kvm.pm
  SCHEDULED: <2020-02-05 Wed>
* TODO [[/home/oleg/majordomo/mail/freshclam/Jenkinsfile][Move Docker Swarm deploy to shared libs]]
  SCHEDULED: <2020-02-24 Mon>
* TODO [https://github.com/NixOS/nix/issues/2208][nix-shell dependencies can be garbage collected any time now / persistent nix-shell envs ?? Issue #2208 ?? NixOS/nix]
  SCHEDULED: <2020-03-09 Mon>
* TODO [[https://kibana.intr/goto/5b656d4c6b23e85df3a38a9aeb9744e9][logstash te userid as field]]
  SCHEDULED: <2020-03-08 Sun>
* TODO Elastic save servers .bash_history
  SCHEDULED: <2020-03-31 Tue>
* TODO Jenkins shedule cron jobs for hms
  SCHEDULED: <2020-03-31 Tue>
* TODO Clean all repositories
  SCHEDULED: <2020-03-08 Sun>
: (export PAGER=cat; for repository in apache*; do echo $repository; for branch in $(git -C $repository branch --remotes | grep -v 'HEAD\|master'); do [[ $(git -C $repository log --format='%ae' $branch | head -1) == "go.wigust@gmail.com" ]] && git -C $repository push --delete origin ${branch#origin/}; done; done)
* TODO [[https://grafana.com/docs/grafana/latest/administration/image_rendering/][Image rendering | Grafana Labs]]
  SCHEDULED: <2020-03-02 Mon>
* TODO [https://github.com/abrander/phpfpmtop][abrander/phpfpmtop: A top like interface for PHP-FPM]
  SCHEDULED: <2020-03-08 Sun>
* TODO jenkins.majordomo.ru
  SCHEDULED: <2020-03-09 Mon>
  : curl 'https://jenkins.majordomo.ru/job/webservices/job/apache2-php73/job/master/35/artifact/result-test/coverage-data/vm-state-dockerNode/wordpress.png'
* TODO Install [https://github.com/raviqqe/muffet][raviqqe/muffet: Fast website link checker in Go]
  SCHEDULED: <2020-03-11 Wed>
* TODO split git commit to a separate stage in awesome
  SCHEDULED: <2020-03-15 Sun>
* TODO session-environment-service-type /home/oleg/src/guix-master/gnu/system/pam.scm
  SCHEDULED: <2020-03-15 Sun>
* TODO https://travis-ci.org/github/mkoppanen/imagick/jobs/527363899/config
  SCHEDULED: <2020-03-31 Tue>
* TODO Switch to python test in Majordomo nixpkgs
  SCHEDULED: <2020-09-01 Tue>
#+begin_example
      start_all()
      server.wait_for_unit("mysql");
      server.wait_for_unit("nginx");
      sleep(5);
      assert "This file is part of nginx" in succeed(
          "curl --fail --header 'example.com' 127.0.0.1/index.php"
      )
#+end_example
* TODO [[https://cerberus.intr/index.php/profiles/ticket/EZ-75759-736/conversation/read_all][Mail notification in sieve]]
  SCHEDULED: <2021-08-02 Mon>
  https://www.rfc-editor.org/rfc/rfc5436.html
* TODO [[https://cerberus.intr/index.php/profiles/ticket/SZ-54634-812/message/14601190][kvm34 замена диска]]
** https://cerberus.intr/index.php/profiles/ticket/WK-81659-519/message/14601097
** https://cerberus.intr/index.php/profiles/ticket/AK-76963-724/message/14604601
* TODO Add PHP update notification [[/home/oleg/archive/src/tmp/php-versions.org][script]]
  SCHEDULED: <2020-03-23 Mon>
  #+BEGIN_SRC bash
    for version in $(curl --silent 'https://news-web.php.net/group.php?group=php.announce&format=rss' | xq --raw-output '.rss.channel.item[] | .title' | awk '/Released/ { print $2 }'); do echo curl --request POST "https://alerta.intr/api/alert" --header "Authorization: Key xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" --header "Content-type: application/json" -d "{\"resource\": \"ci\", \"event\": \"php.version.$version\", \"environment\": \"Production\", \"severity\": \"info\", \"correlate\": [], \"service\": [\"webservices\"], \"group\": null, \"value\": \"$version\", \"text\": \"New PHP $version release\", \"tags\": [], \"attributes\": {}, \"origin\": null, \"type\": null, \"timeout\": 691200, \"rawData\": null, \"customer\": null}"; done
  #+END_SRC
* TODO jenkins web32 linux4.4 fix smartctl
  SCHEDULED: <2020-03-26 Thu>
* TODO Test LSI on NixOS raid controller https://billing2.intr/servers/edit/42
  SCHEDULED: <2020-03-24 Tue>
* TODO web36 php53-hardened
  SCHEDULED: <2020-03-23 Mon>
#+begin_example
  root@web36 ~ # docker logs apache2-php53-hardened
  [Wed Mar 18 05:15:18.007847 2020] [mpm_prefork:notice] [pid 24] AH00163: Apache/2.4.41 (Unix) mpm-itk/2.4.7-04 PHP/5.3.29 configured -- resuming normal operations
  [Wed Mar 18 05:15:18.007892 2020] [mpm_prefork:info] [pid 24] AH00164: Server built: Aug  9 2019 13:36:47
  [Wed Mar 18 05:15:18.007905 2020] [core:notice] [pid 24] AH00094: Command line: '/nix/store/xm89nf0qg88c7l2yxxnpagl5pib8qfrc-apache-httpd-2.4.41/bin/httpd -D FOREGROUND -d /nix/store/gncm5v57wlq48v5r1h49yxxfq48wv9nq-apache2-rootfs-php53/etc/httpd'
  [Wed Mar 18 14:24:52.114603 2020] [mpm_prefork:notice] [pid 24] AH00171: Graceful restart requested, doing restart
  [Wed Mar 18 14:24:52.360462 2020] [mpm_prefork:notice] [pid 24] AH00163: Apache/2.4.41 (Unix) mpm-itk/2.4.7-04 PHP/5.3.29 configured -- resuming normal operations
  [Wed Mar 18 14:24:52.360479 2020] [mpm_prefork:info] [pid 24] AH00164: Server built: Aug  9 2019 13:36:47
  [Wed Mar 18 14:24:52.360485 2020] [core:notice] [pid 24] AH00094: Command line: '/nix/store/xm89nf0qg88c7l2yxxnpagl5pib8qfrc-apache-httpd-2.4.41/bin/httpd -D FOREGROUND -d /nix/store/gncm5v57wlq48v5r1h49yxxfq48wv9nq-apache2-rootfs-php53/etc/httpd'
  [Sun Mar 22 04:47:12.442742 2020] [reqtimeout:info] [pid 32692] [client 127.0.0.1:57438] AH01382: Request header read timeout
  s6-svscan: warning: unable to exec finish script .s6-svscan/finish: Permission denied
  s6-svscan: warning: executing into .s6-svscan/crash
  s6-svscan: fatal: unable to exec .s6-svscan/crash: No such file or directory
#+end_example
* TODO fileserver test.nix [[https://www.youtube.com/results?search_query=rsocket][rsocket - YouTube]]
  SCHEDULED: <2020-03-30 Mon>
* TODO Подключение кабеля IPMI на серверах https://cerberus.intr/index.php/profiles/ticket/AQ-84438-978/conversation/read_all
  SCHEDULED: <2020-03-29 Sun>
   - [[/home/oleg/src/nixpkgs-firefox-esr-52/pkgs/applications/networking/browsers/firefox/packages.nix][firefox]]
   - [[/home/oleg/src/nixpkgs-firefox-esr-52/pkgs/development/compilers/adoptopenjdk-icedtea-web/default.nix][icedtea]]
   - [[/home/oleg/src/nixpkgs-firefox-esr-52/jdk.nix][jdk]]
* sysdig
#+begin_example
  fatal: [web30.intr]: FAILED! => {"changed": true, "cmd": ["/root/docker-pull.sh"], "delta": "0:00:04.814705", "end": "2020-03-27 14:01:40.079347", "msg": "non-zero return code", "rc": 1, "start": "2020-03-27 14:01:35.264642", "stderr": "++ docker images --format '{{ .Repository }}'\n+ for repo in '$(docker images  --format '\\''{{ .Repository }}'\\'')'\n+ docker pull sysdig/sysdig:master\nError response from daemon: manifest for sysdig/sysdig:master not found", "stderr_lines": ["++ docker images --format '{{ .Repository }}'", "+ for repo in '$(docker images  --format '\\''{{ .Repository }}'\\'')'", "+ docker pull sysdig/sysdig:master", "Error response from daemon: manifest for sysdig/sysdig:master not found"], "stdout": "", "stdout_lines": []}
#+end_example
* TODO [[https://cerberus.intr/index.php/profiles/ticket/SN-11785-238/comment/7124095][Запрос из панели AC_131779 (Тема запроса: Баг в SSL-сертификате от Let's Encrypt.)]]
* TODO [[https://cerberus.intr/index.php/profiles/ticket/SV-49154-232/comment/7124536][Появились аккаунты у которых не восстановились файлы после включения (оплаты)]]
#+BEGIN_SRC markdown
  Есть юзер AC_217132, который второй раз не успел оплатить до того как аккаунт выключится.  После оплаты, аккаунт включается, заявок на восстановление баз данных нет.

  Смотрю свой аккаунт AC_208112, после включения нет тоже нет заявок. В дополнение нет заявки на создание базы данных.

  https://hms.majordomo.ru/databases
  ```
  30.03.2020 11:34:29
  Создание пользователя баз данных

  30.03.2020 11:34:34
  Создание базы данных
  ```

  robo3t
  ```
  db.getCollection('accountHistory').find({$and: [{"message": /Поступила заявка на создание базы данных/},{"personalAccountId":"208112"}]})
  ```
  https://imgur.com/PSjhAuw.png

  В контейнерах hms2_personmgr не вижу заявок и trace'ов.
#+END_SRC
* TODO Олег Пыхалов (pyhalov) opened !2 *Jenkinsfile: Add HOSTNAME parameter.* in office / ssl-certificates
  SCHEDULED: <2020-04-05 Sun>
https://gitlab.intr/office/ssl-certificates/-/merge_requests/2
16:36
Оно работает, но т.к. пароль добавлен через credentials'ы jenkins'а, то при удалении хомяка работать перестанет :b
16:37
А примеров с curl'ом я не вижу для генерации именно строки секрета, короче на потом.
16:37
Ну, мержить сейчас можно, не ломает ничего.
16:38
И еще надо будет job'ы удалять сразу, чтобы не палить серты :b

* TODO Add note about NIX CHANNEL
  SCHEDULED: <2020-03-31 Tue>

* TODO filestash
  SCHEDULED: <2020-04-01 Wed>
root@web99:~# docker run -it --network=host --rm --name filestash filestash-dev:4 bash

* TODO when jenkins deploy to swarm and commit has't changed will be the unstash error
  SCHEDULED: <2020-04-26 Sun>
Олег Пыхалов (pyhalov at majordomo.ru)￼  14:38
Это ок? Не может stash. https://jenkins.intr/job/monitoring/job/kapacitor/job/master/2/console
￼
14:39
если коммит не изменился, там всегда фейл

* TODO Gluster offline bricks found on dh2-mr
  SCHEDULED: <2020-05-18 Mon>
На dh2-mr нет бриков текущего гластера, но есть брики нового
(тестового). В общем конкретно на dh2-mr не обращать внимания до тех
пор, пока не сообщим о вводе нового гластера.

* TODO Add script for git clone
  SCHEDULED: <2020-04-05 Sun>
: (f() { xterm -e "set -ex; cd $HOME/archive/src; git clone $1"; }; f "https://github.com/domtronn/all-the-icons.el")

* TODO Rename buildwebservice
  SCHEDULED: <2020-04-05 Sun>
#+BEGIN_SRC emacs-lisp
  (mapcar (lambda (file)
            (find-file file))
          '("/home/oleg/majordomo/apps/bitrix-start/Jenkinsfile"
            "/home/oleg/majordomo/webservices/apache2-perl518/Jenkinsfile"
            "/home/oleg/majordomo/webservices/apache2-php44/Jenkinsfile"
            "/home/oleg/majordomo/webservices/apache2-php52/Jenkinsfile"
            "/home/oleg/majordomo/webservices/apache2-php53/Jenkinsfile"
            "/home/oleg/majordomo/webservices/apache2-php54/Jenkinsfile"
            "/home/oleg/majordomo/webservices/apache2-php55/Jenkinsfile"
            "/home/oleg/majordomo/webservices/apache2-php56/Jenkinsfile"
            "/home/oleg/majordomo/webservices/apache2-php70/Jenkinsfile"
            "/home/oleg/majordomo/webservices/apache2-php71/Jenkinsfile"
            "/home/oleg/majordomo/webservices/apache2-php72/Jenkinsfile"
            "/home/oleg/majordomo/webservices/apache2-php73/Jenkinsfile"
            "/home/oleg/majordomo/webservices/apache2-php73-personal/Jenkinsfile"
            "/home/oleg/majordomo/webservices/apache2-php74/Jenkinsfile"
            "/home/oleg/majordomo/webservices/cron/Jenkinsfile"
            "/home/oleg/majordomo/webservices/ftpserver/Jenkinsfile"
            "/home/oleg/majordomo/webservices/http-fileserver/Jenkinsfile"
            "/home/oleg/majordomo/webservices/nginx/Jenkinsfile"
            "/home/oleg/majordomo/webservices/nginx-php73-private/Jenkinsfile"
            "/home/oleg/majordomo/webservices/nodejs1213/Jenkinsfile"
            "/home/oleg/majordomo/webservices/php4/Jenkinsfile"
            "/home/oleg/majordomo/webservices/php52/Jenkinsfile"
            "/home/oleg/majordomo/webservices/postfix/Jenkinsfile"
            "/home/oleg/majordomo/webservices/ssh-guest-room/Jenkinsfile"
            "/home/oleg/majordomo/webservices/ssh-sup-room/Jenkinsfile"
            "/home/oleg/majordomo/webservices/uwsgi-python37/Jenkinsfile"
            "/home/oleg/majordomo/webservices/webftp-new/Jenkinsfile"))
#+END_SRC

* TODO STUMPWM добавить “дежурный мод” (переменную) который позволит игнорировать время
  SCHEDULED: <2020-04-04 Sat>

* TODO jenkins disable host verification ("Host Key Verification Strategy")
  SCHEDULED: <2020-04-07 Tue>

* TODO postfix staff
  SCHEDULED: <2020-04-08 Wed>
#+begin_example
  Apr  7 17:18:19 smtp-staff postfix/smtpd[1467]: 59B7131405B4: client=dh2-mr.intr[172.16.103.156]
  Apr  7 17:18:19 smtp-staff postfix/cleanup[1470]: 59B7131405B4: message-id=<cbb33f72f0b719bbbd1ffef794ff8984@mail-manager.intr>
  Apr  7 17:18:19 smtp-staff opendkim[9834]: 59B7131405B4: DKIM-Signature field added (s=dkim, d=majordomo.ru)
  Apr  7 17:18:19 smtp-staff postfix/smtpd[9269]: connect from dh1-mr.intr[172.16.103.155]
  Apr  7 17:18:19 smtp-staff postfix/smtpd[9269]: 6141A31405E0: client=dh1-mr.intr[172.16.103.155]
  Apr  7 17:18:19 smtp-staff postfix/cleanup[9272]: 6141A31405E0: message-id=<aabef4654036414e257549a0a18f91ee@mail-manager.intr>
  Apr  7 17:18:19 smtp-staff opendkim[9834]: 6141A31405E0: DKIM-Signature field added (s=dkim, d=majordomo.ru)
  Apr  7 17:18:19 smtp-staff postfix/qmgr[2976]: 59B7131405B4: from=<noreply@majordomo.ru>, size=15097, nrcpt=2 (queue active)
  Apr  7 17:18:19 smtp-staff postfix/smtpd[1467]: disconnect from dh2-mr.intr[172.16.103.156] ehlo=1 mail=1 rcpt=2 data=1 quit=1 commands=6
  Apr  7 17:18:19 smtp-staff postfix/qmgr[2976]: 6141A31405E0: from=<noreply@majordomo.ru>, size=13367, nrcpt=2 (queue active)
  Apr  7 17:18:19 smtp-staff postfix/smtpd[9269]: disconnect from dh1-mr.intr[172.16.103.155] ehlo=1 mail=1 rcpt=2 data=1 quit=1 commands=6
  Apr  7 17:18:19 smtp-staff postfix-mailout/smtp[448]: 226823160AB1: to=<alumos@mail.ru>, relay=mxs.mail.ru[94.100.180.31]:25, delay=0.62, delays=0.11/0/0.05/0.45, dsn=2.0.0, status=sent (250 OK id=1jLp3T-0008U1-BR)
  Apr  7 17:18:19 smtp-staff postfix-mailout/qmgr[5781]: 226823160AB1: removed
  Apr  7 17:18:19 smtp-staff postfix/smtp[9265]: 6141A31405E0: to=<turm@turm2rm.ru>, relay=mmxs.majordomo.ru[78.108.80.147]:25, delay=0.41, delays=0.09/0.02/0.07/0.22, dsn=2.0.0, status=sent (250 OK id=1jLp3T-0000w6-Iq)
  Apr  7 17:18:19 smtp-staff postfix/smtp[1471]: 6141A31405E0: to=<turm@mail.ru>, relay=mxs.mail.ru[94.100.180.31]:25, delay=0.59, delays=0.09/0.02/0.11/0.37, dsn=2.0.0, status=sent (250 OK id=1jLp3T-000AKw-Kx)
  Apr  7 17:18:19 smtp-staff postfix/smtp[9266]: 59B7131405B4: to=<12volt.kr@mail.ru>, relay=mxs.mail.ru[94.100.180.31]:25, delay=0.62, delays=0.11/0.03/0.11/0.38, dsn=2.0.0, status=sent (250 OK id=1jLp3T-0006I1-M0)
  Apr  7 17:18:19 smtp-staff postfix/smtp[9266]: 59B7131405B4: to=<art6.krasnodar@mail.ru>, relay=mxs.mail.ru[94.100.180.31]:25, delay=0.62, delays=0.11/0.03/0.11/0.38, dsn=2.0.0, status=sent (250 OK id=1jLp3T-0006I1-M0)
  Apr  7 17:18:19 smtp-staff postfix/qmgr[2976]: 6141A31405E0: removed
  Apr  7 17:18:20 smtp-staff postfix/qmgr[2976]: 59B7131405B4: removed
#+end_example

* TODO Moodle
  SCHEDULED: <2020-04-13 Mon>
Коля насчет Moodle что-то написал?
Юзер спрашивает доколе
https://cerberus.intr/index.php/profiles/ticket/JN-93547-362/message/14746990
Так выяснили же что либо 7.3, либо отключение опкэша
```Резвов Александр И можешь подробности по сегфолту написать
12:21
Кондрашкин Николай Одна из ситуаций когда происходит сегфолт - этап проверки конфигурации сервера при установке последней версии Moodle.
Пример стрейса: /home/u220037/yvloar.aq/strace.log на web26
12:22
Еще была жалоба на 502 от чувака с WP после того как он криво ссылки с http на https заменил и появились ссылки начинающиеся с httpss://, но как ее воспроизвести клиент не сообщил.
12:25
Резвов Александр А ссылки нет?
12:25
Кондрашкин Николай На что?
12:25
Резвов Александр На жалобу
12:28
Кондрашкин Николай https://cerberus.intr/index.php/profiles/ticket/LS-83644-341/conversation
12:29
Я его переключил на 7.3 но Дима все равно сказал сносить испорченную базу.
12:30
Резвов Александр Ладно, с мудлом будет проще воспроизвести
12:31
Кондрашкин Николай Вот http://moodle.majordomo-test.tk/admin/index.php
12:36
Резвов Александр А если выключить opcache, то работает
14:12
Кондрашкин Николай А как полностью выключить opcache?
14:12
Резвов Александр php_flag opcache.enable off```
opcache не надо раде одной cms вырубать
Так никто не предлагает его вырубать глобально
free and open-source learning management system 
Moodle is used for blended learning, distance education, flipped classroom and other e-learning projects in schools, universities, workplaces and other sectors

его реально вообще использовать на виртуальном хостиге не в курсе?
Реально
прекрасно встает на 37 вебе
урок можно провести?
:D
я просто думаю, может инсталятор запилить
Там несколько иная система (у меня в универе такая)
Он будет работать только на 37
пока да

* TODO mariadb docker run --restart unless-stopped
  SCHEDULED: <2020-04-13 Mon>

* TODO https://jenkins.intr/job/ci/job/bfg/job/master/16/console
  SCHEDULED: <2020-04-16 Thu>
  https://jenkins.intr/job/webservices/job/nixoverlay/job/master/46/console
