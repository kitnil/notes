<!-- markdown-toc start - Don't edit this section. Run M-x markdown-toc-generate-toc again -->
**Table of Contents**

- [TODO:](#todo)
- [Настройка операционной системы без головной боли](#настройка-операционной-системы-без-головной-боли)
- [Способы настройки операционной системы](#способы-настройки-операционной-системы)
- [Что такое Ansible?](#что-такое-ansible)
- [Преимущества](#преимущества)
    - [Настройки в одном месте](#настройки-в-одном-месте)
    - [История изменений](#история-изменений)
    - [Идемпотентность](#идемпотентность)
    - [Простота и читабельность](#простота-и-читабельность)
- [Установка Ansible](#установка-ansible)
- [Первые шаги](#первые-шаги)
    - [Введение](#введение)
    - [Первый playbook](#первый-playbook)
    - [Запускаем playbook](#запускаем-playbook)
    - [Установка всех пакетов из списка](#установка-всех-пакетов-из-списка)
        - [Запускаем playbook](#запускаем-playbook)
    - [Настраиваем vim](#настраиваем-vim)
        - [Запускаем playbook](#запускаем-playbook)
- [Итог](#итог)

<!-- markdown-toc end -->

TODO:
=====

1. Добавить изображение командной строки.
2. Побольше раскрыть преимущества.
3. Добавить установка Ansible в ROSA.
4. Побольше раскрыть итог.

Настройка операционной системы без головной боли
================================================

Способы настройки операционной системы
======================================

* ручная настройка с помощью **командной строки** или **графических утилит** по мере
  необходимости
  
![Коммандая строка]()
![OpenSUSE yast](http://opensuse-guide.org/images/screenshots/yast-controlcenter.png)

* автоматическая настройка с помощью **bash (shell)** *script*

* умная автоматическая настройка с помощью **Ansible**

Что такое Ansible?
==================

**Ansible** - это СПО (свободное программное обеспечение) для настройки и управления
компьютерами.

![Ansible логотип](https://worldvectorlogo.com/logos/ansible.svg)

Преимущества
============

Настройки в одном месте
-----------------------

Все файлы настроек програм, **находятся в одном месте**. 

История изменений
-----------------

Всю **историю изменений** в системе можно просмотреть.

Идемпотентность
---------------

Команды должны выполняться лишь тогда, когда в этом есть необходимость.

Простота и читабельность
------------------------

Использование **yml файлов**, которые гораздо **легче писать и приятнее читать**.

Установка Ansible
=================

Для установки воспользуемся командной строкой.

Debian/Ubuntu:

    $ sudo apt install ansible
    
Fedora:

    $ sudo dnf install ansible

CentOS:

    $ sudo yum install ansible

ROSA:

    ?
    
Первые шаги
===========

Введение
--------

Для начала мы будем управлять компьютером, на котором установлен Ansible.

Язык, который используется для взаимодействия с Ansible называется **playbook**.

Первый playbook
---------------

Создаем файл **site.yml** любым текстовым редактором:

    $ nano site.yml

и копируем из примера ниже playbook, задачей которой является установка лучшего
консольного текстового редактора **vim**:

    ---
    - hosts: localhost
      connection: local
      become: yes
      tasks:
      - name: ensure vim is installed
        apt: name=vim state=installed
    
В завимости от операционной системы GNU/Linux, следует заменить **apt** на тот
пакетный мэнэджэр, которым вы установили Ansible.

Запускаем playbook
------------------

Запустить полученный playbook:

    $ ansible-playbook --ask-become-pass site.yml

вводим пароль sudo пользователя.

Ansible ответит желтым текстом, что **произошло одноизменение в системе**.

Попробуйте запустить playbook еще раз:

    $ ansible-playbook --ask-become-pass site.yml

Ansible проверит установлен ли пакет *vim* и не запустит установку снова, сообща
об этом зеленым текстом.

Установка всех пакетов из списка
--------------------------------

Для установки нескольких пакетов, мы воспользуемся встроенной в Ansible
возможностью **loop**:

    ---
    - hosts: localhost
      connection: local
      become: yes
      tasks:
      - name: ensure vim and git is installed
        apt: name={{ item }} state=installed
        with_items:
          - vim
          - git

### Запускаем playbook ###

    $ ansible-playbook --ask-become-pass site.yml

Ansible снова проверит установлен ли пакет *vim*, но так как пакет *git*
отсутствует, Ansible ответит желтым текстом, **что произошло одноизменение в
системе**.

Настраиваем vim
---------------

Для удобства, **создаем отдельную папку *ansible* и перемещаем playbook в нее**:

    $ mkdir -p ansible
    $ mv site.yml ansible/
    $ cd ansible/

Теперь создаем файл настроек для *vim*:
    
    $ 
    $ vi vimrc
    
для примера включим отображение строк добавив в **vimrc**:

    set number
    
сохраняем и выходим.

Открываем playbook site.yml:

    $ vi site.yml
    
добавляем задачу, для создания ссылки:

    - name: linking vim config
      file:
        state: link
        src: "{{ local_home }}/ansible/vimrc"
        dest: "{{ local_home }}/.vimrc"
        
### Запускаем playbook ###

    $ ansible-playbook --ask-become-pass site.yml

Итог
====

Каждый раз при запуске *playbook*, Ansible проверит установлен ли **vim** и
**git**, а также удостоверится что **сделана ссылка на настройки vim**.
